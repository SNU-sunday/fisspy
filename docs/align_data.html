{% extends 'docs/fisspy_template.html' %}
{% set active_panel = 'align' %}
{% set active_sp = "ALdata" %}

{% block manual %}
<h2 class="page-header subpack-title">Align data</h2>

<h3 class="code-h3">Examples</h3>
<hr>
<div class="col-md-6">
  <div class="row g-0 border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
    <div class="col p-4 d-flex flex-column position-static">
      <h3 class="mb-0">Make align data cube</h3>
      <a href="./example/" class="icon-link gap-1 icon-link-hover stretched-link">
        View
        <svg class="bi"><use xlink:href="#chevron-right"/></svg>
      </a>
    </div>
  </div>
</div>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="alignAll"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">alignAll</span>(<span class="code-arg">lfA, lfB, refFrame=None, refCam='A', sname=None, save=True</span>)</p>
<strong>Description: Align data with time and co-align the data of two cams.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>lfA (<span class="code-type">list</span>) - A series of the camA data files.</li>
    <li>lfB (<span class="code-type">list</span>) - A series of the camB data files.</li>
    <li>refFrame (<span class="code-type">int</span>, optional) - Reference frame number. If None, the middle frame (time) is considered as a reference. Default is None.</li>
    <li>refCam (<span class="code-type">str</span>, optional) - Reference camera for the alignment. Either 'A' or 'B'. Default is 'A'.</li>
    <li>save (<span class="code-type">bool</span>, optional) - Save align paramereters in the working directory. Default is True.
</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>alignParsA (<span class="code-type">dict</span>) - alignPars for cam A. See <a href="./#calAlignPars">fisspy.align.alignment.calAlignPars</a>.</li>
    <li>alignParsB (<span class="code-type">dict</span>) - alignPars for cam B. See <a href="./#calAlignPars">fisspy.align.alignment.calAlignPars</a>.</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="alignTwoDataCubes"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">alignTwoDataCubes</span>(<span class="code-arg">dataA, dataB, faparA, faparB, xmargin=None, ymargin=None, cubic=False</span>)</p>
<strong>Description: Align two 3D data cubes. Note that the data will be flipped in the x-axis to correct the mirror reversal.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>dataA (<span class="code-type">numpy.ndarray</span>) - 3-dimensional data array for the cam A with the shape of (nt, ny, nx).</li>
    <li>dataB (<span class="code-type">numpy.ndarray</span>) - 3-dimensional data array for the cam B with the shape of (nt, ny, nx).</li>
    <li>faparA (<span class="code-type">str</span>) - File name of the alignpar for cam A.</li>
    <li>faparB (<span class="code-type">str</span>) - File name of the alignpar for cam B.</li>
    <li>xmargin (<span class="code-type">int</span>, optional) - Margin for x-axis. The size of the x-axis increases to nx + 2*xmargin. If None, automatically calculate the margin. Default is None.</li>
    <li>ymargin (<span class="code-type">int</span>, optional) - Margin for y-axis The size of the y-axis increases to ny + 2*ymargin. If None, automatically calculate the margin. Default is None.</li>
    <li>cubic (<span class="code-type">bool</span>, optional) - Use cubic interpolation to determine the value in the aligned position. If False, use linear interpolation. Default is None.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>cdata (<span class="code-type">numpy.ndarray</span>) - Aligned data.</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="saveAlignCube"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">saveAlignCube</span>(<span class="code-arg">adata, time, sname, dt=None, dx=0.16*725, dy=0.16*725</span>)</p>
<strong>Description: Save aligned data cube.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>adata (<span class="code-type">numpy.ndarray</span>) - 3D array of the aligned data (nt,ny,nx).</li>
    <li>time (<span class="code-type">numpy.ndarray</span>) - 1D time array in unit of second.</li>
    <li>sname (<span class="code-type">str</span>) - Filename to save. Extension should be '.npz.'</li>
    <li>dt (<span class="code-type">float</span>, optional) - Pixel scale along the t-axis in unit of second.</li>
    <li>dx (<span class="code-type">float</span>, optional) - Pixel scale along the x-axis in unit of km.</li>
    <li>dy (<span class="code-type">float</span>, optional) - Pixel scale along the y-axis in unit of km.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>None</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="writeAlignPars"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">writeAlignPars</span>(<span class="code-arg">apar, refCam=None, sname=None</span>)</p>
<strong>Description: Write a file for the align parameters.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>apar (<span class="code-type">dict</span>) - Parameter to align the data files. See <a href="./#calAlignPars">fisspy.align.alignment.calAlignPars</a>.</li>
    <li>refCam (<span class="code-type">str</span>, optional) - Reference camera for the alignment.</li>
    <li>sname (<span class="code-type">str</span>, optional) - Save file name. The extension should be .npz. Default is alignpar_{apar['cam']} in the current working directory. </li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>None</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="readAlignPars"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">readAlignPars</span>(<span class="code-arg">apfile</span>)</p>
<strong>Description: Read file for the align parameters.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>apfile (<span class="code-type">str</span>) - Filename for the align parameters.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>apar (<span class="code-type">numpy.lib.npyio.NpzFile</span>) - Align parameters. keys: ['cam', 'refFrame', 'refTime', 'time', 'xc', 'yc', 'dx', 'dy', 'angle', 'refCam']</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="calAlignPars"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">calAlignPars</span>(<span class="code-arg">lfiles, refFrame=None</span>)</p>
<strong>Description: Calculate the parameters to be used for the alignment for given series of the line spectra.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>lfiles (<span class="code-type">list</span>) - A series of the FISS data files (either cam A or cam B)</li>
    <li>refFrame (<span class="code-type">int</span>, optional) - Reference frame number. If None, the middle frame (time) is considered as a reference. Default is None.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>alignPars (<span class="code-type">dict</span>) - Parameter to align the data files. It consists of 9 elements:
        (1) 'cam'-camera information either 'A' or 'B'.
        (2) 'refFrame'-Reference frame number.
        (3) 'refTime'-(str) isot time for the reference frame.
        (4) 'time'-relative time to the reference time in the unit of second.
        (5) 'xc'-x posiotion of the center of the rotation.
        (6) 'yc'-y posiotion of the center of the rotation.
        (7) 'dx'-shift in the direction of the x axis.
        (8) 'dy'-shift in the direction of the y axis.
        (9) 'angle'-angle of the image rotation.</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="alignCams"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">alignCams</span>(<span class="code-arg">frefA, frefB, refCam='A'</span>)</p>
<strong>Description: Align two cameras.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>frefA (<span class="code-type">str</span>) - Filename of the camera A for the reference frame.</li>
    <li>frefB (<span class="code-type">str</span>) - Filename of the camera B for the reference frame.</li>
    <li>refCam (<span class="code-type">str</span>, optional) - Reference camera for the alignment. Either 'A' or 'B'. Default is 'A'.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>refCam (<span class="code-type">str</span>) - Reference camera for the alignment.</li>
    <li>dx (<span class="code-type">float</span>) - Shift in the direction of the x axis.</li>
    <li>dy (<span class="code-type">float</span>) - Shift in the direction of the y axis.</li>
</ul>
<br><br>
<p style="font-size: x-large; font-weight: bold;" id="alignDataCube"><span class="code-function">function</span> fisspy.align.alignment.<span class="text-warning">alignDataCube</span>(<span class="code-arg">data, fapar, xmargin=None, ymargin=None, cubic=False</span>)</p>
<strong>Description: Align 3D data cube for given apar. Note that the data will be flipepd in the x-axis to correct the mirror reversal. Please do not use this function when you use two data cubes of two cams, but use <a href="./#alignTwoDataCubes">fisspy.align.alignment.alignTwoDataCubes</a>.</strong><br><br>
<p class="code-par">Parameters</p>
<ul>
    <li>data (<span class="code-type">numpy.ndarray</span>) - 3-dimensional data array with the shape of (nt, ny, nx).</li>
    <li>fapar (<span class="code-type">dict</span>) - File name of the alignpar.</li>
    <li>xmargin (<span class="code-type">int</span>, optional) - Margin for x-axis. The size of the x-axis increases to nx + 2*xmargin. If None, automatically calculate the margin. Default is None.</li>
    <li>ymargin (<span class="code-type">int</span>, optional) - Margin for y-axis. The size of the y-axis increases to ny + 2*ymargin. If None, automatically calculate the margin. Default is None.</li>
    <li>cubic (<span class="code-type">bool</span>, optional) - Use cubic interpolation to determine the value in the aligned position. If False, use linear interpolation. Default is None.</li>
</ul>
<p class="code-par">Returns</p>
<ul>
    <li>cdata (<span class="code-type">numpy.ndarray</span>) - Aligned data.</li>
</ul>

{% endblock %}